<div class="card">
  <div class="card-header">
    <button type="button" class="btn btn-default" (click)="showInstructions = !showInstructions">
      Toggle instructions
    </button>
    <div [ngbCollapse]="!showInstructions">
      <h5>Instructions</h5>
      <ul>
        <li>
          <strong>View Attachments</strong>
          <p>Each resource is listed below.  For each resource, any attachment that is available for use is displayed in its section.</p>
          <p><strong>ID</strong> identifies the attachment in the API.
            These values are mainly useful to developers who need to know how the attachment is referenced.</p>
          <p>The <strong>filename</strong> can be used by content editors to use the attachment in the resource.</p>
          <p>Simply click <strong>View</strong> to see the attachment.</p>
        </li>
        <li><strong>Upload Attachment</strong>
          <p>New attachments can be uploaded and then used in a resource.  Attachments are scoped to a particular resource, so when uploading
            a new attachment, you must also choose the resource to associate it with.  To associate an attachment to multiple resources, it currently must
            be uploaded one time for each resource it needs to be associated with.</p>
        </li>
      </ul>
    </div>
  </div>
  <div class="card-body">
    <h5>Upload new attachment</h5>
    <input type="file" ng2FileSelect [uploader]="uploader" #uploadElement />
    Resource
    <select [(ngModel)]="selectedResource">
      <option *ngFor="let resource of resources" [ngValue]="resource">{{ resource.name }}</option>
    </select>
    Include in package?
    <select [(ngModel)]="is_zipped">
      <option value="true">Yes</option>
      <option value="false">No</option>
    </select>
    <button (click)="uploadNewFile()" class="btn btn-success">
      <i class="fa fa-cloud-upload"></i> Upload
    </button>
    <ngb-alert type="info" [dismissible]="false" *ngIf="uploader.isUploading">
      Uploading...
    </ngb-alert>
    <ngb-alert type="success" [dismissible]="false" *ngIf="success">
      Success!
    </ngb-alert>
  </div>
</div>
<ngb-alert type="danger" [dismissible]="false" *ngIf="errorMessage">
  {{errorMessage}}
</ngb-alert>
<ngb-alert type="warning" [dismissible]="false" *ngIf="loading">
  Loading...
</ngb-alert>
<h3 class="card-title">Attachments</h3>
<div *ngFor="let resource of resources">
  <div *ngIf="resource.attachments.length > 0">
    <h4>{{resource.name}}</h4>
    <div class="container">
      <strong>
        <div class="row">
          <div class="col">
            ID
          </div>
          <div class="col">
            Filename
          </div>
          <div class="col">
            Included in package?
          </div>
          <div class="col">
            Actions
          </div>
        </div>
      </strong>
      <div *ngFor="let attachment of resource.attachments">
        <div class="row">
          <div class="col">
            {{attachment.id}}
          </div>
          <div class="col">
            {{attachment['file-file-name']}}
          </div>
          <div class="col">
            <span *ngIf="attachment['is-zipped']">Yes</span>
            <span *ngIf="!attachment['is-zipped']">No</span>
          </div>
          <div class="col">
            <button (click)="showAttachment(attachment)" class="btn btn-secondary">
              View
            </button>
            <button (click)="showConfirmButton(attachment)" class="btn btn-danger">
              Delete
            </button>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <ngb-alert type="danger" [dismissible]="false" *ngIf="attachment.canConfirmDelete">
              Are you sure you want to delete {{attachment['file-file-name']}}?
              <button (click)="deleteAttachment(attachment)" class="btn btn-dark">Confirm</button>
              <button (click)="attachment.canConfirmDelete = !attachment.canConfirmDelete" class="btn btn-secondary">Cancel</button>
            </ngb-alert>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
